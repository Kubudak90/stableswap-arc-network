# StableSwap Arc Network - Architecture

## System Overview

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           USER INTERFACE LAYER                               │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                         Frontend (React)                             │   │
│  │   ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────────────┐   │   │
│  │   │  Swap    │  │ Liquidity│  │  Stake   │  │    Dashboard     │   │   │
│  │   │   UI     │  │    UI    │  │    UI    │  │       UI         │   │   │
│  │   └────┬─────┘  └────┬─────┘  └────┬─────┘  └────────┬─────────┘   │   │
│  │        │              │              │                │             │   │
│  │        └──────────────┴──────────────┴────────────────┘             │   │
│  │                              │                                       │   │
│  │                    ┌─────────▼─────────┐                            │   │
│  │                    │   Config.js        │                            │   │
│  │                    │   (Addresses +     │                            │   │
│  │                    │    Settings)       │                            │   │
│  │                    └─────────┬─────────┘                            │   │
│  └──────────────────────────────┼──────────────────────────────────────┘   │
│                                 │                                           │
└─────────────────────────────────┼───────────────────────────────────────────┘
                                  │
                                  │ Web3 / ethers.js
                                  ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                        SMART CONTRACT LAYER                                  │
│                                                                              │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │                         GOVERNANCE LAYER                               │  │
│  │   ┌─────────────────┐       ┌─────────────────┐                       │  │
│  │   │    TimeLock     │       │   MultiSigWallet │                       │  │
│  │   │                 │       │                  │                       │  │
│  │   │  - 1h-30d delay │       │  - N-of-M owners │                       │  │
│  │   │  - Queue/Execute│       │  - Tx confirm    │                       │  │
│  │   │  - Cancel       │       │  - Owner mgmt    │                       │  │
│  │   └────────┬────────┘       └────────┬─────────┘                       │  │
│  │            │                         │                                 │  │
│  │            └────────────┬────────────┘                                 │  │
│  │                         │ Ownership                                    │  │
│  │                         ▼                                              │  │
│  └───────────────────────────────────────────────────────────────────────┘  │
│                                                                              │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │                           CORE PROTOCOL                                │  │
│  │                                                                        │  │
│  │   ┌───────────────────────────────────────────────────────────────┐   │  │
│  │   │                        Router                                  │   │  │
│  │   │      (User-friendly interface with approval handling)         │   │  │
│  │   └───────────────────────────┬───────────────────────────────────┘   │  │
│  │                               │                                        │  │
│  │                               ▼                                        │  │
│  │   ┌───────────────────────────────────────────────────────────────┐   │  │
│  │   │                    StableSwapPool                              │   │  │
│  │   │                                                                │   │  │
│  │   │  ┌────────────┐  ┌────────────┐  ┌────────────────────────┐   │   │  │
│  │   │  │   token0   │  │   token1   │  │      LP Token          │   │   │  │
│  │   │  │   (USDC)   │  │   (USDT)   │  │   (Minted/Burned)      │   │   │  │
│  │   │  └──────┬─────┘  └──────┬─────┘  └───────────┬────────────┘   │   │  │
│  │   │         │               │                    │                │   │  │
│  │   │         └───────┬───────┘                    │                │   │  │
│  │   │                 │                            │                │   │  │
│  │   │    ┌────────────▼────────────┐              │                │   │  │
│  │   │    │   Curve StableSwap AMM  │              │                │   │  │
│  │   │    │   D = An^n Σx + D^(n+1) │              │                │   │  │
│  │   │    └────────────┬────────────┘              │                │   │  │
│  │   │                 │                            │                │   │  │
│  │   │    ┌────────────▼────────────────────────────▼───────────┐   │   │  │
│  │   │    │              Security Features                       │   │   │  │
│  │   │    │  • Flash Loan Protection (same-block guard)          │   │   │  │
│  │   │    │  • Price Manipulation Guard (max 10% swap)           │   │   │  │
│  │   │    │  • Reentrancy Guard                                  │   │   │  │
│  │   │    │  • Pausable (emergency)                              │   │   │  │
│  │   │    │  • Emergency Withdraw                                │   │   │  │
│  │   │    └─────────────────────────────────────────────────────┘   │   │  │
│  │   │                         │                                     │   │  │
│  │   │                         │ Fees                                │   │  │
│  │   │                         ▼                                     │   │  │
│  │   └───────────────────────────────────────────────────────────────┘   │  │
│  │                                                                        │  │
│  └───────────────────────────────────────────────────────────────────────┘  │
│                                                                              │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │                         TOKEN ECONOMICS                                │  │
│  │                                                                        │  │
│  │   ┌─────────────────────────────────────────────────────────────────┐ │  │
│  │   │                     FeeDistributor                               │ │  │
│  │   │                                                                  │ │  │
│  │   │   Collected Fees ──┬──────────────────────────────────────────► │ │  │
│  │   │                    │                                             │ │  │
│  │   │        ┌───────────┼───────────┬───────────────┐                │ │  │
│  │   │        │           │           │               │                │ │  │
│  │   │        ▼           ▼           ▼               ▼                │ │  │
│  │   │    ┌──────┐   ┌──────┐    ┌──────┐       ┌──────┐              │ │  │
│  │   │    │ 45%  │   │ 45%  │    │ 10%  │       │      │              │ │  │
│  │   │    │Staker│   │Buyback│   │Treas.│       │Salary│              │ │  │
│  │   │    └──┬───┘   └──┬───┘    └──┬───┘       └──┬───┘              │ │  │
│  │   │       │          │           │              │                   │ │  │
│  │   └───────┼──────────┼───────────┼──────────────┼───────────────────┘ │  │
│  │           │          │           │              │                     │  │
│  │           ▼          ▼           ▼              ▼                     │  │
│  │   ┌────────────┐  ┌────────────────┐  ┌─────────┐  ┌──────────────┐  │  │
│  │   │  Staking   │  │  AutoBuyback   │  │Treasury │  │   Salary     │  │  │
│  │   │  Contract  │  │                │  │ Wallet  │  │   Address    │  │  │
│  │   │            │  │  ┌──────────┐  │  └─────────┘  └──────────────┘  │  │
│  │   │ ┌────────┐ │  │  │DEX Router│  │                                 │  │
│  │   │ │ASS Stake│ │  │  └────┬─────┘  │                                 │  │
│  │   │ │  Earn   │ │  │       │        │                                 │  │
│  │   │ │Rewards  │ │  │       ▼        │                                 │  │
│  │   │ └────────┘ │  │  ┌──────────┐   │                                 │  │
│  │   │            │  │  │   Burn   │   │                                 │  │
│  │   │            │  │  │   90%    │   │                                 │  │
│  │   │            │  │  └──────────┘   │                                 │  │
│  │   └────────────┘  └─────────────────┘                                 │  │
│  │                                                                        │  │
│  │   ┌─────────────────────────────────────────────────────────────────┐ │  │
│  │   │                        ASSToken                                  │ │  │
│  │   │                                                                  │ │  │
│  │   │   • ERC20 Governance Token                                      │ │  │
│  │   │   • Controlled Minting (FeeDistributor, LiquidityRewards)       │ │  │
│  │   │   • Burnable (deflationary via AutoBuyback)                     │ │  │
│  │   │   • No Max Supply (inflation controlled by governance)          │ │  │
│  │   │                                                                  │ │  │
│  │   └─────────────────────────────────────────────────────────────────┘ │  │
│  │                                                                        │  │
│  └───────────────────────────────────────────────────────────────────────┘  │
│                                                                              │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │                          UTILITIES                                     │  │
│  │                                                                        │  │
│  │   ┌──────────────────┐                                                │  │
│  │   │    Multicall     │  Batch multiple calls into single transaction  │  │
│  │   └──────────────────┘                                                │  │
│  │                                                                        │  │
│  └───────────────────────────────────────────────────────────────────────┘  │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

## Data Flow Diagrams

### 1. Swap Flow

```
User                    Router              StableSwapPool         FeeDistributor
  │                        │                      │                       │
  │   swapExactTokens      │                      │                       │
  ├───────────────────────►│                      │                       │
  │                        │                      │                       │
  │                        │    transferFrom      │                       │
  │                        ├─────────────────────►│                       │
  │                        │                      │                       │
  │                        │       swap()         │                       │
  │                        ├─────────────────────►│                       │
  │                        │                      │                       │
  │                        │                      │   collectFee()        │
  │                        │                      ├──────────────────────►│
  │                        │                      │                       │
  │                        │    return amountOut  │                       │
  │                        │◄─────────────────────┤                       │
  │                        │                      │                       │
  │   transfer tokens      │                      │                       │
  │◄───────────────────────┤                      │                       │
  │                        │                      │                       │
```

### 2. Add Liquidity Flow

```
User                    Router              StableSwapPool           LPToken
  │                        │                      │                      │
  │   addLiquidity         │                      │                      │
  ├───────────────────────►│                      │                      │
  │                        │                      │                      │
  │                        │  transferFrom x2     │                      │
  │                        ├─────────────────────►│                      │
  │                        │                      │                      │
  │                        │   addLiquidity()     │                      │
  │                        ├─────────────────────►│                      │
  │                        │                      │                      │
  │                        │                      │    mint()            │
  │                        │                      ├─────────────────────►│
  │                        │                      │                      │
  │                        │   return lpOut       │                      │
  │                        │◄─────────────────────┤                      │
  │                        │                      │                      │
  │   transfer LP          │                      │                      │
  │◄───────────────────────┤                      │                      │
  │                        │                      │                      │
```

### 3. Fee Distribution Flow

```
                        FeeDistributor
                              │
                              │ distributeFees()
                              │
           ┌──────────────────┼──────────────────┐
           │                  │                  │
           ▼                  ▼                  ▼
    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
    │   Staking   │    │ AutoBuyback │    │  Treasury   │
    │    (45%)    │    │    (45%)    │    │   (10%)     │
    └──────┬──────┘    └──────┬──────┘    └─────────────┘
           │                  │
           │                  │ executeBuyback()
           │                  │
           │           ┌──────┴──────┐
           │           │             │
           │           ▼             ▼
           │    ┌─────────────┐ ┌─────────┐
           │    │   Salary    │ │   Burn  │
           │    │   (10%)     │ │  (90%)  │
           │    └─────────────┘ └─────────┘
           │
           ▼
    ┌─────────────────────────────────────┐
    │           StakingContract           │
    │                                     │
    │  updateRewards() → rewardPerToken   │
    │                                     │
    │  Users claim via claimRewards()     │
    └─────────────────────────────────────┘
```

### 4. Governance Flow

```
                 MultiSigWallet                TimeLock
                       │                          │
  Owner 1 ────────────►│                          │
  submitTransaction    │                          │
                       │                          │
  Owner 2 ────────────►│                          │
  confirmTransaction   │                          │
                       │                          │
  Owner 3 ────────────►│                          │
  confirmTransaction   │                          │
                       │                          │
                       │   Enough confirmations   │
                       │                          │
                       │    queueTransaction()    │
                       ├─────────────────────────►│
                       │                          │
                       │                          │  Wait for delay
                       │                          │  (1h - 30d)
                       │                          │
                       │   executeTransaction()   │
                       ├─────────────────────────►│
                       │                          │
                       │                          │    Execute
                       │                          │──────────────►
                       │                          │    Target
                       │                          │    Contract
```

## Contract Dependencies

```
                    ┌──────────────────┐
                    │    ASSToken      │
                    └────────┬─────────┘
                             │
          ┌──────────────────┼──────────────────┐
          │                  │                  │
          ▼                  ▼                  ▼
┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐
│ FeeDistributor  │  │ LiquidityRewards│  │ StakingContract │
│                 │  │   (optional)    │  │                 │
└────────┬────────┘  └─────────────────┘  └────────┬────────┘
         │                                         │
         ├─────────────────────────────────────────┤
         │                                         │
         ▼                                         │
┌─────────────────┐                               │
│  AutoBuyback    │◄──────────────────────────────┘
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│   DEX Router    │
│  (External)     │
└─────────────────┘

┌─────────────────┐       ┌─────────────────┐
│ StableSwapPool  │◄─────►│     Router      │
└────────┬────────┘       └─────────────────┘
         │
         ▼
┌─────────────────┐
│    LPToken      │
└─────────────────┘
```

## Security Model

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          SECURITY LAYERS                                 │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  Layer 1: Access Control                                                 │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │  Ownable     │  Specific Roles (FeeDistributor, LiquidityRewards)  │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  Layer 2: Governance                                                     │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │  MultiSig (N-of-M)  │  TimeLock (1h-30d delay)                     │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  Layer 3: Transaction Safety                                             │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │  ReentrancyGuard  │  SafeERC20  │  forceApprove Pattern            │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  Layer 4: Protocol Protection                                            │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │  Flash Loan Guard  │  Max Swap Limit  │  Slippage Protection       │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  Layer 5: Emergency                                                      │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │  Pausable  │  Emergency Withdraw  │  Circuit Breakers              │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

## Gas Optimization Techniques

| Technique | Implementation | Gas Saved |
|-----------|---------------|-----------|
| Loop increment | `unchecked { ++i }` | ~5 gas/iteration |
| Length caching | `uint256 len = arr.length` | ~100 gas |
| Multicall batching | `Multicall.aggregate()` | 21,000 gas/tx |
| Storage packing | Struct optimization | Variable |
| immutable variables | `immutable` keyword | ~200 gas/read |

## Test Coverage

| Contract | Tests | Coverage |
|----------|-------|----------|
| StableSwapPool | 18 | ~95% |
| Router | 15 | ~98% |
| ASSToken | 12 | ~100% |
| FeeDistributor | 16 | ~90% |
| StakingContract | 20 | ~95% |
| AutoBuyback | 18 | ~90% |
| TimeLock | 15 | ~95% |
| MultiSigWallet | 33 | ~98% |
| **Total** | **226** | **~95%** |

---

*Architecture documentation for StableSwap Arc Network v1.0*
